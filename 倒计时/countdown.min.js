
var countdown=function(options){
var $=function(id){
return typeof id==='string'?document.getElementById(id):id;
};
var id=options.id,
date=options.date,
leadingZero=options.leadingZero||false,
htmlTemplate=options.htmlTemplate||'<i class="day">%{d}天</i><i class="hour">%{h}时</i><i class="minute">%{m}分</i><i class="second">%{s}秒</i>',
onComplete=options.onComplete||function(){},
countdownDay = date,
useServerTime=options.useServerTime||false,
showDate=options.showDate||false,
sTime=options.sTime||null,
rDate=/(%\{d\}|%\{h\}|%\{m\}|%\{s\})/g,
rDays=/%\{d\}/,
rHours=/%\{h\}/,
rMins=/%\{m\}/,
rSecs=/%\{s\}/,
floor=Math.floor,
tLeft,dLeft,hLeft,mLeft,sLeft,html,servertime,nowTime,timer=null,xmlHttp=null;
xmlHttp=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject('Microsoft.XMLHTTP');
function zero(num){
if(num<=9){
return'0'+num;
}
return num;
}
if(sTime){nowTime= sTime - 1000}
(function showTime(){
nowTime+=1000;
tLeft=countdownDay-nowTime;
dLeft=floor(tLeft/86400000);
hLeft=floor((tLeft%86400000)/3600000);
mLeft=floor((tLeft%86400000%3600000)/60000);
sLeft=floor((tLeft%86400000%3600000%60000)/1000);

//dLeft=floor(tLeft/86400);
//hLeft=floor((tLeft%86400)/3600);
//mLeft=floor((tLeft%86400%3600)/60);
//sLeft=floor((tLeft%86400%3600%60)/);

if(leadingZero){
dLeft=zero(dLeft);
hLeft=zero(hLeft);
mLeft=zero(mLeft);
sLeft=zero(sLeft);
}
if(tLeft>=0){
if(showDate){
html=htmlTemplate.replace(rDays,dLeft).replace(rHours,hLeft).replace(rMins,mLeft).replace(rSecs,sLeft);
}else{
hLeft=zero(parseInt((dLeft*24)+hLeft));
html=htmlTemplate.replace(rHours,hLeft).replace(rMins,mLeft).replace(rSecs,sLeft);
}
}else{
if(showDate){
html=htmlTemplate.replace(rDate,'00');
}else{
html=htmlTemplate.replace(rHours,'00').replace(rMins,'00').replace(rSecs,'00');
}
clearTimeout(timer);
onComplete();
return;
}
$(id).innerHTML=html;
timer=setTimeout(showTime,1000);
})();
}