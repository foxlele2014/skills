<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="http://js.3conline.com/js/jquery-1.5.min.js"></script>
</head>

<body>
<button id='do'> Do long calc!</button>
<div id='status'></div>
<div id='result'></div>


	<script>
// 	function foo() {
//     console.log( 'first' );
//     setTimeout( ( function(){ console.log( 'second' ); } ), 5);
// 	}

// for (var i = 0; i < 10; i++) {
//     foo();
// }


$('#do').bind('click', function(){
var _date = new Date().getTime();
  $('#status').text('calculating....'); //此处会触发redraw事件的fired，但会放到队列里执行，直到long()执行完。

  // long();//执行长时间任务，阻塞

  // with set timeout, works as expected
  setTimeout(long,50);//用定时器，大约50ms以后执行长时间任务，放入执行队列，但在redraw之后了，根据先进先出原则
 console.log((new Date().getTime()-_date));
 })



function long(){
  var result = 0
  for (var i = 0; i<1000; i++){
    for (var j = 0; j<1000; j++){
      for (var k = 0; k<1000; k++){
        result = result + i+j+k
      }
    }
  }
  $('#status').text('calclation done') // has to be in here for this example. or else it will ALWAYS run instantly. This is the same as passing it a callback
}
// 例子2
// for(var i=0;i<5;i++){
//     setTimeout(function(){
//         console.log(i);
//     },0);
// }
//例子3
// for(var i=0;i<5;i++){
//     setTimeout((function(pars){
//         return function(){console.log(pars)};
//     })(i),0);
// }
	</script>
</body>
</html>